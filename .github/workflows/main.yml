name: Kaggle
on: 
  workflow_dispatch:
  push:
      branches:
          - main
jobs:
  pushToKaggle:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repository
        uses: actions/checkout@v4
      - name: Cache
        uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/README.md') }}
          restore-keys: ${{ runner.os }}-pip-
      - name: Login
        uses: osbm/kaggle-login@main
        with:
          KAGGLE_USERNAME: mh0386
          KAGGLE_KEY: ${{ secrets.KAGGLE_KEY }}
      - name: Upload Dataset
        run: |
          rm -rd .git
          rm -rd .github
          kaggle d metadata mh0386/seismic-data
          git add dataset-metadata.json
          git commit -m "Update dataset-metadata.json"
          git pull
          git push
          kaggle d version -r tar -m https://github.com/MH0386/seismic_data/commit/${{ github.sha }}
